<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Shop — TrendAura Social</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="/css/styles.css" />
  <style>
    /* small page-specific tweaks (optional) */
    .page-title { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="header" role="banner">
    <div class="inner">
      <a class="brand" href="index.html">
        <h1>TrendAura Social</h1>
      </a>
      <nav class="nav" role="navigation" aria-label="Main">
        <a href="index.html">Home</a>
        <a href="shop.html">Shop</a>
        <a href="cart.html">Cart</a>
      </nav>
    </div>
  </header>

  <!-- Main container -->
  <main class="container" role="main">
    <div class="page-title">
      <h2>Shop Products</h2>
      <div class="small">Browse our curated selection</div>
    </div>

    <!-- Product Grid (will be populated dynamically) -->
    <div id="product-grid" class="product-grid" aria-live="polite">
      <!-- JS will render product-card elements here -->
    </div>

    <!-- If there are no products -->
    <div id="no-products" class="empty" style="display:none;">No products found.</div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      &copy; <span id="year"></span> TrendAura Social — All rights reserved.
    </div>
  </footer>

  <!-- Scripts -->
  <!-- products.js and catalog.js provide product loading & rendering -->
  <!-- cart.js provides addToCart(...) and localStorage cart handling -->
  <script src="/js/products.js"></script>
  <script src="/js/cart.js"></script>
  <script src="/js/toast.js"></script>

  <!-- Inline catalog renderer that matches the CSS/product-card structure -->
  <script>
  (async function renderCatalog(){
    // fetch product list (products.json expected at project root)
    try {
      const res = await fetch('/products.json');
      if (!res.ok) throw new Error('Could not load products.json');
      const products = await res.json();
      const grid = document.getElementById('product-grid');
      const noProducts = document.getElementById('no-products');

      if (!products || products.length === 0) {
        noProducts.style.display = 'block';
        grid.style.display = 'none';
        return;
      }

      noProducts.style.display = 'none';
      grid.innerHTML = '';

      products.forEach(p => {
        const card = document.createElement('article');
        card.className = 'product-card';
        card.innerHTML = `
          <div class="product-media">
            <a href="product.html?slug=${encodeURIComponent(p.slug)}" title="${escapeHtml(p.title)}">
              <img src="${p.images && p.images[0] ? p.images[0] : '/assets/images/placeholder.png'}" alt="${escapeHtml(p.title)}">
            </a>
          </div>
          <div class="product-info">
            <a href="product.html?slug=${encodeURIComponent(p.slug)}" class="product-title">${escapeHtml(p.title)}</a>
            <p class="product-desc">${escapeHtml(p.description || '')}</p>
            <div class="price-row">
              <span class="price">${p.currency ? escapeHtml(p.currency) + ' ' : ''}${Number(p.price).toFixed(2)}</span>
              <button class="btn add-cart" data-id="${escapeHtml(p.id)}">Add to Cart</button>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });

      // wire up Add to Cart buttons
      document.querySelectorAll('.add-cart').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          const id = btn.getAttribute('data-id');
          // find product by id
          const product = products.find(x => x.id === id);
          if (!product) { alert('Product not found'); return; }
          
          // Create cart item object matching your cart.js structure
          const item = {
            id: product.id,
            slug: product.slug,
            title: product.title,
            price: product.price,
            currency: product.currency || 'USD',
            images: product.images || [],
            quantity: 1
          };

          // Use global addToCart if present, else fallback to a simple localStorage implementation
          try {
            if (typeof addToCart === 'function') {
              addToCart(item); // your cart.js implementation
            } else {
              // fallback: local add-to-cart
              const cart = JSON.parse(localStorage.getItem('cart') || '[]');
              const existing = cart.find(ci => ci.id === item.id);
              if (existing) existing.quantity += 1;
              else cart.push(item);
              localStorage.setItem('cart', JSON.stringify(cart));
            }
            // user feedback
            // update UI & show toast
            btn.textContent = 'Added';
            toast && toast.show(`${product.title} added to cart`, { duration: 2200, type: 'success' });
            setTimeout(() => { btn.textContent = 'Add to Cart'; }, 1100);
          
          
          } catch (err) {
            console.error('Add to cart error', err);
            alert('Could not add to cart. See console for details.');
          }
        });
      });

    } catch (err) {
      console.error('Error loading products', err);
      document.getElementById('no-products').style.display = 'block';
      document.getElementById('no-products').textContent = 'Failed to load products.';
    }

    // small helper to avoid injecting HTML unsafely
    function escapeHtml(str) {
      if (!str && str !== 0) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');
    }
  })();
  </script>

</body>
</html>
