<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Everything Go-Karts â€” Home</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  
  <!-- Load Tailwind CSS for modern styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
    body { font-family: 'Inter', sans-serif; background-color: #f7fafc; }
    
    /* Global Styles */
    .header { background-color: #1f2937; color: white; padding: 1rem 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .header .inner { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 1.5rem; }
    .header .brand h1 { font-size: 1.5rem; font-weight: 900; color: #34d399; }
    .header .nav a { margin-left: 1.5rem; color: #d1d5db; text-decoration: none; transition: color 0.2s; }
    .header .nav a:hover { color: white; }

    .hero { background-color: #34d399; color: white; padding: 4rem 0; text-align: center; }
    .hero h2 { font-size: 3rem; font-weight: 700; margin-bottom: 0.5rem; }
    .hero p { font-size: 1.25rem; margin-bottom: 1.5rem; }
    
    .container { max-width: 1200px; margin: 0 auto; padding: 2rem 1.5rem; }
    .container h2 { font-size: 2rem; font-weight: 700; color: #1f2937; margin-bottom: 1.5rem; border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem; }

    /* Search Bar Styling */
    .search-bar-hero { margin-top: 2rem; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; }
    .search-bar-hero input {
      width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    /* Autocomplete List Styling */
    .autocomplete-list { 
        position: absolute; z-index: 100; width: 100%; background-color: #fff; border: 1px solid #d1d5db; 
        border-top: none; list-style-type: none; padding: 0; margin: 0; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); 
        max-height: 200px; overflow-y: auto; display: none; border-radius: 0 0 8px 8px; text-align: left;
    }
    .autocomplete-list li { 
        padding: 10px; cursor: pointer; font-size: 0.9rem; color: #4b5563; border-bottom: 1px solid #f3f4f6;
    }
    .autocomplete-list li:hover, .autocomplete-list li.active { background-color: #e5e7eb; }


    /* Product Grid and Card */
    #featured-products {
        display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem;
    }

    .product-card {
        background: white; border-radius: 12px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        overflow: hidden; transition: transform 0.3s, box-shadow 0.3s; display: flex; flex-direction: column;
    }
    .product-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
    .product-media img { width: 100%; height: 200px; object-fit: cover; transition: opacity 0.3s; }
    .product-info { padding: 1rem; flex-grow: 1; display: flex; flex-direction: column; }
    .product-title { font-size: 1.25rem; font-weight: 700; color: #1f2937; margin-bottom: 0.25rem; text-decoration: none; }
    .product-desc { 
        font-size: 0.875rem; color: #6b7280; margin-bottom: 0.75rem; flex-grow: 1; 
        display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;  
        overflow: hidden; text-overflow: ellipsis;
    }
    
    /* Discount Price Styling */
    .price-container {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .price { font-size: 1.5rem; font-weight: 700; color: #34d399; }
    .original-price {
        font-size: 1rem;
        text-decoration: line-through;
        color: #9ca3af; /* Gray text for crossed-out price */
    }
    /* End Discount Price Styling */
    
    .rating { color: #facc15; font-size: 1rem; }

    /* --- Action Buttons (Cart/Wishlist) --- */
    .add-to-cart-btn, .add-to-wishlist-btn {
      /* Base styles: light background, standard border */
      background-color: white; 
      border: 1px solid #d1d5db; 
      padding: 10px; font-size: 1rem;
      cursor: pointer; border-radius: 8px; transition: background-color 0.2s, color 0.2s, border-color 0.2s;
      line-height: 1; display: flex; align-items: center; justify-content: center;
    }

    /* CART ICON STYLE */
    .add-to-cart-btn {
      color: #4b5563; /* Cart icon default color */
    }
    .add-to-cart-btn:hover { background-color: #f1f5ff; color: #3b82f6; border-color: #3b82f6; }
    .add-to-cart-btn.added {
      background-color: #10b981 !important; color: white !important; border-color: #10b981 !important;
      cursor: default; font-weight: 600;
    }
    .add-to-cart-btn.loading {
        background-color: #e0f2f1;
        color: #0d9488;
        cursor: wait;
    }


    /* WISHLIST ICON STYLE (Heart color control) */
    .add-to-wishlist-btn {
      /* Default state for SVG: Faint Outline */
      border-color: #d1d5db; /* Light border */
      /* Set the SVG fill to none and stroke to a faint color */
    }
    
    .add-to-wishlist-btn svg {
      fill: none; /* No fill */
      stroke: #d1d5db; /* Faint outline color */
      stroke-width: 2;
      transition: stroke 0.2s, fill 0.2s;
    }
    
    .add-to-wishlist-btn:not(.wished):hover { 
        background-color: #f9fafb; /* Slight hover background */
        border-color: #fca5a5;
    }
    /* On hover of unwished, make the outline slightly more visible/pink */
    .add-to-wishlist-btn:not(.wished):hover svg {
        stroke: #fca5a5;
    }
    
    /* WISHED STATE: Heart turns solid red */
    .add-to-wishlist-btn.wished {
      background-color: white !important; 
      border-color: #ef4444 !important; 
      cursor: pointer; /* Keep cursor pointer so it can be unwished */
    }

    .add-to-wishlist-btn.wished svg {
      fill: #ef4444; /* Solid red fill */
      stroke: #ef4444; /* Solid red stroke */
    }
    
    .add-to-wishlist-btn.wished:hover {
        background-color: #fef2f2 !important; /* light red hover state */
    }
    .add-to-wishlist-btn.loading {
        background-color: #f0f9ff;
        color: #0284c7;
        cursor: wait;
    }

    /* Loading Spinner (for initial load) */
    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-top: 4px solid #34d399;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 2rem auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <header class="header" role="banner">
    <div class="inner">
      <a class="brand" href="index.html"><h1>Everything Go-Karts</h1></a>
      <nav class="nav" role="navigation" aria-label="Main">
        <a href="index.html">Home</a>
        <a href="shop.html">Shop</a>
        <a href="cart.html" class="flex items-center space-x-1">
            <span>Cart</span>
            <!-- Cart count is updated via Firestore listener -->
            <span id="cart-count" class="bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded-full hidden">0</span>
        </a>
        <a href="wishlist.html">Wishlist</a>
      </nav>
    </div>
  </header>

  <section class="hero">
    <div class="inner container">
      <div>
        <h2>Welcome to the Go-Kart Market</h2>
        <p>Premium Go-Karts and Accessories.</p>
        <div class="search-bar-hero relative">
          <input type="text" id="hero-search-input" placeholder="Search for products, e.g., 'tires'">
          <ul id="hero-autocomplete-list" class="autocomplete-list"></ul>
        </div>
        <p id="user-info" class="text-xs mt-4 opacity-75">Loading...</p>
      </div>
    </div>
  </section>

  <section class="container">
    <h2>Shop by Category</h2>
    <div id="category-buttons" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <div class="spinner"></div>
    </div>
  </section>

  <main class="container" id="main">
    <h2>Featured Products</h2>
    <div id="featured-products" class="product-grid">
        <div class="spinner"></div>
    </div>
    <div class="mt-8 text-center">
      <a class="btn bg-gray-200 text-gray-700 py-2 px-4 rounded-lg font-semibold hover:bg-gray-300 transition" href="shop.html?primaryCategory=all">Browse all products</a>
    </div>
  </main>

  <footer class="footer bg-gray-800 text-white mt-10 py-4">
    <div class="container text-center">&copy; <span id="year"></span> Everything Go-Karts</div>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, query, where, doc, setDoc, deleteDoc, onSnapshot, addDoc, updateDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // Set Firestore logging level for debugging
    setLogLevel('Debug');

    // --- Firebase Global Vars and Initialization ---
    const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
    
    let app, db, auth;
    let currentUserId = null;
    let cartItems = []; // Global state for cart items fetched via onSnapshot
    let wishlistItems = []; // Global state for wishlist items fetched via onSnapshot
    let allProducts = []; // Global state for mock products data

    function getProductDocRef(collectionName, productId) {
      // Products are identified by their 'id' (from products.json). This ID serves as the Firestore document ID.
      return doc(db, `artifacts/${appId}/users/${currentUserId}/${collectionName}`, productId);
    }

    /**
     * Initializes Firebase and sets up authentication.
     */
    async function initializeAndAuthenticate() {
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            if (initialAuthToken) {
                await signInWithCustomToken(auth, initialAuthToken);
            } else {
                await signInAnonymously(auth);
            }
        } catch (error) {
            console.error("Firebase initialization or authentication failed:", error);
        }
    }
    
    /**
     * Updates the UI display for the cart count.
     */
    function updateCartCountDisplay() {
        const totalItems = cartItems.reduce((sum, item) => sum + (item.quantity || 0), 0);
        const cartCountElement = document.getElementById('cart-count');
        if (cartCountElement) {
            cartCountElement.textContent = totalItems;
            cartCountElement.classList.toggle('hidden', totalItems === 0);
        }
    }
    
    /**
     * Sets up real-time listeners for Cart and Wishlist once the user is authenticated.
     */
    function setupFirebaseListeners(userId) {
        if (!db || !userId) {
            console.error("Database or User ID is not available for listeners.");
            return;
        }
        
        // --- CART LISTENER ---
        const cartColRef = collection(db, `artifacts/${appId}/users/${userId}/cartItems`);
        onSnapshot(cartColRef, (snapshot) => {
            cartItems = snapshot.docs.map(doc => ({
                id: doc.id,
                ...doc.data()
            }));
            updateCartCountDisplay();
            // Since product cards are re-rendered based on static product data, 
            // we don't need to re-render them here, but we need the wishlist listener
            // to potentially update button states if an item is moved to/from wishlist.
        }, (error) => {
            console.error("Error setting up cart listener:", error);
        });

        // --- WISHLIST LISTENER ---
        const wishlistColRef = collection(db, `artifacts/${appId}/users/${userId}/wishlistItems`);
        onSnapshot(wishlistColRef, (snapshot) => {
            wishlistItems = snapshot.docs.map(doc => ({
                id: doc.id,
                ...doc.data()
            }));
            // Re-render featured products to reflect the latest wishlist state
            const featured = allProducts.filter(p => p.featured).slice(0, 4); 
            renderProducts(featured, "featured-products");
        }, (error) => {
            console.error("Error setting up wishlist listener:", error);
        });
    }

    // --- Product Rendering and Logic (Modified to use global cart/wishlist state) ---
    
    function escapeHtml(str) {
      if (!str) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');
    }
    
    function getStarRating(rating = 5) {
        const fullStar = 'â˜…';
        const emptyStar = 'â˜†';
        const r = Math.round(rating);
        return `<span class="rating">${fullStar.repeat(r)}${emptyStar.repeat(5 - r)}</span>`;
    }

    // SVG icon for the heart (outline/filled state controlled by CSS)
    const heartIconSvg = `
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart">
            <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>
        </svg>
    `;

    /**
     * Calculates the final price based on the product's defined discount rate.
     */
    function calculateDiscountedPrice(product) {
        let finalPrice = product.price;
        let isDiscounted = false;
        
        const discountRate = product.discount || 0; 

        if (discountRate > 0 && discountRate < 1) {
            finalPrice = product.price * (1 - discountRate);
            isDiscounted = true;
        }
        
        finalPrice = Math.max(0, finalPrice);
        finalPrice = parseFloat(finalPrice.toFixed(2));

        return { finalPrice: finalPrice, isDiscounted: isDiscounted };
    }


    // Render products: Cart button uses only icon, Wishlist button uses colorable heart
    function renderProducts(products, targetId) {
      const container = document.getElementById(targetId);
      if (container.querySelector('.spinner')) {
         container.innerHTML = ""; // Clear spinner once data is ready
      }
      
      if (!products.length) {
        container.innerHTML = "<p class='text-center text-gray-500'>No featured products available.</p>";
        return;
      }
      
      const html = products.map(p => {
        // Use global wishlistItems state to check if the product is wished
        const isWished = wishlistItems.some(item => item.id === p.id) ? 'wished' : '';
        const { finalPrice, isDiscounted } = calculateDiscountedPrice(p);

        return `
          <div class="product-card">
            <a href="product.html?slug=${encodeURIComponent(p.slug)}" class="product-media">
              <img src="${escapeHtml(p.images[0] || 'https://placehold.co/600x400/34d399/ffffff?text=GoCart')}" 
                   alt="${escapeHtml(p.title)}"
                   onerror="this.onerror=null;this.src='https://placehold.co/600x400/34d399/ffffff?text=GoCart';"
              >
            </a>
            <div class="product-info">
              <a href="product.html?slug=${encodeURIComponent(p.slug)}" class="product-title">${escapeHtml(p.title)}</a>
              <div class="text-sm mb-2">
                  ${getStarRating(p.rating || 5)} <span class="text-gray-500 ml-1">(Mock Reviews)</span>
              </div>
              <p class="product-desc line-clamp-2">${escapeHtml(p.description)}</p>
              
              <div class="product-actions flex items-center justify-between pt-2 border-t border-gray-100">
                  <div class="price-container">
                    ${isDiscounted 
                        ? `<span class="original-price">$${p.price.toFixed(2)}</span><span class="price">$${finalPrice.toFixed(2)}</span>`
                        : `<span class="price">$${p.price.toFixed(2)}</span>`
                    }
                  </div>

                  <div class="flex items-center gap-2">
                      <button class="add-to-cart-btn" onclick="window.addToCart(this, '${p.id}')" aria-label="Add to Cart">
                        ðŸ›’
                      </button>
                      <button class="add-to-wishlist-btn ${isWished}" onclick="window.toggleWishlist(this, '${p.id}')" aria-label="${isWished ? 'Remove from Wishlist' : 'Add to Wishlist'}">
                        ${heartIconSvg}
                      </button>
                  </div>
              </div>
            </div>
          </div>
        `;
      }).join("");

      container.innerHTML = html;
    }

    // --- Firestore Cart Logic ---
    window.addToCart = async function(buttonElement, productId) {
      if (!db || !currentUserId) return console.error("Database not ready.");

      buttonElement.disabled = true;
      buttonElement.classList.add('loading');
      const originalContent = buttonElement.innerHTML;

      try {
        const product = allProducts.find(p => p.id === productId);
        if (!product) throw new Error("Product not found.");

        const { finalPrice } = calculateDiscountedPrice(product);
        const existingCartItem = cartItems.find(item => item.id === productId);

        const itemRef = getProductDocRef('cartItems', productId);

        if (existingCartItem) {
          // Item exists, increment quantity
          await updateDoc(itemRef, {
            quantity: existingCartItem.quantity + 1,
            // Always update price on re-add for current discount
            calculatedPrice: finalPrice 
          });
        } else {
          // Item is new, create document with product data
          await setDoc(itemRef, {
            ...product,
            quantity: 1,
            calculatedPrice: finalPrice
          });
        }
        
        // Visual Feedback (since Firestore update might be slightly delayed)
        buttonElement.innerHTML = 'Added! âœ“'; 
        buttonElement.classList.remove('loading');
        buttonElement.classList.add('added');

        setTimeout(() => {
          buttonElement.innerHTML = originalContent; 
          buttonElement.classList.remove('added');
          buttonElement.disabled = false;
        }, 1500);

      } catch (error) {
        console.error("Error adding to cart:", error);
        buttonElement.innerHTML = originalContent;
        buttonElement.classList.remove('loading');
        buttonElement.disabled = false;
      }
    }

    // --- Firestore Wishlist Logic ---
    window.toggleWishlist = async function(buttonElement, productId) {
      if (!db || !currentUserId) return console.error("Database not ready.");

      buttonElement.disabled = true;
      buttonElement.classList.add('loading');
      const originalContent = buttonElement.innerHTML;

      try {
        const isWished = buttonElement.classList.contains('wished');
        const itemRef = getProductDocRef('wishlistItems', productId);
        const product = allProducts.find(p => p.id === productId);
        
        if (isWished) {
          // Remove from wishlist
          await deleteDoc(itemRef);
          buttonElement.innerHTML = heartIconSvg; // Revert to icon immediately
          buttonElement.classList.remove('wished');
          
        } else {
          // Add to wishlist
          if (!product) throw new Error("Product not found.");
          // Use product id as document id for easy look up and removal
          await setDoc(itemRef, product); 
          buttonElement.innerHTML = 'Added!'; // Visual text feedback

        }
        
        buttonElement.classList.remove('loading');
        buttonElement.disabled = false;
        
        // Revert text to the SVG icon after delay, relying on the onSnapshot listener to update the 'wished' class
        setTimeout(() => {
            if (!buttonElement.classList.contains('wished')) {
                buttonElement.innerHTML = heartIconSvg;
            } else {
                buttonElement.innerHTML = originalContent;
            }
        }, 1000);

      } catch (error) {
        console.error(`Error toggling wishlist state for ${productId}:`, error);
        buttonElement.innerHTML = originalContent;
        buttonElement.classList.remove('loading');
        buttonElement.disabled = false;
      }
    }


    // --- Search Logic (No Change) ---
    function redirectToShopSearch(searchTerm) {
      if (searchTerm) {
        window.location.href = `shop.html?search=${encodeURIComponent(searchTerm)}`;
      }
    }
    
    function searchAndAutocomplete(query) {
        const searchTerm = query.toLowerCase().trim();
        const autocompleteList = document.getElementById('hero-autocomplete-list');
        
        if (searchTerm.length < 2) {
            autocompleteList.style.display = 'none';
            return;
        }
        
        const searchTerms = searchTerm.split(/\s+/).filter(term => term.length > 0);

        const uniqueSuggestions = new Set();
        allProducts.forEach(p => {
            const productText = `${p.title} ${p.description} ${p.primaryCategory} ${p.subcategory} ${p.filters.join(' ')}`.toLowerCase();
            
            searchTerms.forEach(term => {
                if (productText.includes(term)) {
                    uniqueSuggestions.add(p.title);
                }
            });
        });

        const suggestions = [...uniqueSuggestions].slice(0, 5); 

        if (suggestions.length) {
          autocompleteList.innerHTML = suggestions.map(s => `<li>${escapeHtml(s)}</li>`).join('');
          autocompleteList.style.display = 'block';
        } else {
          autocompleteList.style.display = 'none';
        }
    }

    // --- Main Initialization ---
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById('year').textContent = new Date().getFullYear();
      
      // Setup Firebase and Auth Listener
      initializeAndAuthenticate();
      
      onAuthStateChanged(auth, async (user) => {
        if (user) {
            currentUserId = user.uid;
            document.getElementById('user-info').textContent = `User ID: ${user.uid.substring(0, 8)}... (signed in)`;
            setupFirebaseListeners(currentUserId);
            
            // --- Fetch Static Product Data & Render ---
            fetch('/products.json')
                .then(res => {
                    if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                    return res.json();
                })
                .then(products => {
                    allProducts = products; 
                    
                    // 1. Featured products
                    const featured = products.filter(p => p.featured).slice(0, 4); 
                    featured.sort((a, b) => (b.rating || 0) - (a.rating || 0)); 
                    // Note: renderProducts will use the global wishlistItems state which is populated by the listener
                    renderProducts(featured, "featured-products");

                    // 2. Category rendering
                    const categoriesMap = {};
                    products.forEach(p => {
                        if (!categoriesMap[p.primaryCategory]) {
                          categoriesMap[p.primaryCategory] = new Set();
                        }
                        categoriesMap[p.primaryCategory].add(p.subcategory || p.primaryCategory); 
                    });

                    const catContainer = document.getElementById("category-buttons");
                    catContainer.innerHTML = Object.keys(categoriesMap).map(primary => {
                        const subs = [...categoriesMap[primary]]
                            .filter(Boolean) 
                            .map(sub => `
                          <a class="btn small text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg transition" 
                            href="shop.html?primaryCategory=${encodeURIComponent(primary)}${sub !== primary ? `&subcategory=${encodeURIComponent(sub)}` : ''}">
                            ${escapeHtml(sub)}
                          </a>`).join(" ");

                        return `
                          <div class="p-6 bg-white rounded-xl shadow-lg border border-gray-100">
                            <h3 class="text-xl font-bold text-gray-700 mb-4">${escapeHtml(primary)}</h3>
                            <div class="flex flex-wrap gap-3">
                              ${subs}
                            </div>
                          </div>
                        `;
                    }).join("");
                })
                .catch(err => {
                    console.error("Error loading products:", err);
                    document.getElementById("featured-products").innerHTML = "<p class='text-center text-red-500'>Could not load featured products. Please check the data source.</p>";
                    document.getElementById("category-buttons").innerHTML = "<p class='text-center text-red-500'>Could not load categories.</p>";
                });
        } else {
            // Should not happen with anonymous sign-in, but good practice
            currentUserId = null;
            document.getElementById('user-info').textContent = "User authentication failed. Data saving disabled.";
        }
      });

      // Search Bar Event Listeners
      const heroSearchInput = document.getElementById('hero-search-input');
      const autocompleteList = document.getElementById('hero-autocomplete-list');

      heroSearchInput.addEventListener("input", (e) => {
        searchAndAutocomplete(e.target.value);
      });
      
      heroSearchInput.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
          redirectToShopSearch(heroSearchInput.value.trim()); 
        }
      });

      autocompleteList.addEventListener('click', (e) => {
        if (e.target.tagName === 'LI') {
          const selectedText = e.target.textContent;
          heroSearchInput.value = selectedText;
          autocompleteList.style.display = 'none';
          redirectToShopSearch(selectedText); 
        }
      });

      document.addEventListener('click', (e) => {
        if (!e.target.closest('.search-bar-hero')) {
          autocompleteList.style.display = 'none';
        }
      });
    });
  </script>
</body>
</html>
